<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üè∞ Ashval Chat - Notion MCP Integration</title>
    <link rel="stylesheet" href="index.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body data-theme="dark">
    <div class="main-layout">
        <aside id="sidebar">
            <div class="sidebar-header">
                <button id="new-chat-button" class="button primary">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="20" height="20"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"></path></svg>
                    <span>New Chat</span>
                </button>
            </div>
            <nav id="chat-list" class="chat-list"></nav>
        </aside>

        <div class="app-container">
            <header class="app-header">
                <button id="sidebar-toggle" class="icon-button" aria-label="Toggle sidebar">
                    <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg>
                </button>
                <h1 id="chat-title">üè∞ Ashval Chat</h1>
                <div class="header-actions">
                    <div class="header-action-container">
                        <button type="button" id="share-button" class="icon-button" aria-label="Share chat">
                             <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3s3-1.34 3-3-1.34-3-3-3z"></path></svg>
                        </button>
                    </div>
                     <div class="header-action-container">
                        <button type="button" id="theme-toggle-button" class="icon-button" aria-label="Toggle theme">
                            <svg class="sun" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zM2 13h2c.55 0 1-.45 1-1s-.45-1-1-1H2c-.55 0-1 .45-1 1s.45 1 1 1zm18 0h2c.55 0 1-.45 1-1s-.45-1-1-1h-2c-.55 0-1 .45-1 1s.45 1 1 1zM11 2v2c0 .55.45 1 1 1s1-.45 1-1V2c0-.55-.45-1-1-1s-1 .45-1 1zm0 18v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1zM5.64 5.64c-.39-.39-1.02-.39-1.41 0-.39.39-.39 1.02 0 1.41l1.06 1.06c.39.39 1.02.39 1.41 0s.39-1.02 0-1.41L5.64 5.64zm12.72 12.72c-.39-.39-1.02-.39-1.41 0-.39.39-.39 1.02 0 1.41l1.06 1.06c.39.39 1.02.39 1.41 0 .39-.39.39-1.02 0-1.41l-1.06-1.06zM5.64 18.36l1.06-1.06c.39-.39.39-1.02 0-1.41-.39-.39-1.02-.39-1.41 0l-1.06 1.06c-.39.39-.39 1.02 0 1.41s1.02.39 1.41 0zM19.42 6.7l-1.06-1.06c-.39-.39-1.02-.39-1.41 0-.39.39-.39 1.02 0 1.41l1.06 1.06c.39.39 1.02.39 1.41 0s.39-1.03 0-1.41z"></path></svg>
                            <svg class="moon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12.38 2.03c.38-.28.81-.43 1.25-.43.43 0 .85.14 1.2.41.69.52.95 1.39.68 2.18-.23.68-.78 1.23-1.46 1.46-1.9.64-3.46 2.2-4.1 4.1-.23.68-.78 1.23-1.46 1.46-.79.27-1.66.02-2.18-.68-.69-.52-.95-1.39-.68-2.18C6.39 6.2 9.77 2.82 12.38 2.03zM11.5 8.5c.92 0 1.75.26 2.49.69.49.29.98.05 1.22-.48.24-.52.01-1.12-.5-1.34-1.3-.57-2.73-.87-4.21-.87-5.02 0-9.15 3.84-9.5 8.82-.03.45.3.85.75.88.45.03.85-.3.88-.75.29-4.01 3.52-7.24 7.53-7.53.52-.04.94-.48.94-1z"></path></svg>
                        </button>
                    </div>
                    <div class="header-action-container">
                        <button type="button" id="export-button" class="icon-button" aria-label="Export chat">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M18 15v3H6v-3H4v3c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2v-3h-2zm-1-4-1.41-1.41L13 12.17V4h-2v8.17L8.41 9.59 7 11l5 5 5-5z"></path></svg>
                        </button>
                        <div id="export-menu" class="actions-menu hidden">
                            <a href="#" data-format="txt">as TXT</a>
                            <a href="#" data-format="md">as MD</a>
                            <a href="#" data-format="html">as HTML</a>
                            <a href="#" data-format="pdf">as PDF</a>
                        </div>
                    </div>
                    <button type="button" id="settings-button" class="icon-button" aria-label="Settings">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M19.43 12.98c.04-.32.07-.64.07-.98s-.03-.66-.07-.98l2.11-1.65c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.3-.61-.22l-2.49 1c-.52-.4-1.08-.73-1.69-.98l-.38-2.65C14.46 2.18 14.25 2 14 2h-4c-.25 0-.46.18-.49.42l-.38 2.65c-.61.25-1.17.59-1.69.98l-2.49-1c-.23-.09-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64l2.11 1.65c-.04.32-.07.65-.07.98s.03.66.07.98l-2.11 1.65c-.19.15-.24.42.12.64l2 3.46c.12.22.39.3.61.22l2.49-1c.52.4 1.08.73 1.69.98l.38 2.65c.03.24.24.42.49.42h4c.25 0 .46-.18.49-.42l.38-2.65c.61-.25 1.17-.59 1.69-.98l2.49 1c.23.09.49 0 .61.22l2-3.46c.12-.22.07-.49-.12-.64l-2.11-1.65zM12 15.5c-1.93 0-3.5-1.57-3.5-3.5s1.57-3.5 3.5-3.5 3.5 1.57 3.5 3.5-1.57 3.5-3.5 3.5z"></path></svg>
                    </button>
                </div>
            </header>
            <div id="chat-container" class="chat-container" aria-live="polite">
                <!-- Chat messages will be appended here -->
            </div>
            <div id="file-preview-container" class="file-preview-container"></div>
            <form id="prompt-form" class="prompt-form">
                <input type="file" id="file-input" hidden accept="image/*,application/pdf,text/*,.md,.docx,.csv,.xlsx">
                <button type="button" id="attach-file-button" class="icon-button" aria-label="Attach file">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="24" height="24">
                        <path d="M16.5 6v11.5c0 2.21-1.79 4-4 4s-4-1.79-4-4V5c0-1.38 1.12-2.5 2.5-2.5s2.5 1.12 2.5 2.5v10.5c0 .28-.22.5-.5.5s-.5-.22-.5-.5V6H10v9.5c0 1.38 1.12 2.5 2.5 2.5s2.5-1.12 2.5-2.5V5c0-2.21-1.79-4-4-4S7 2.79 7 5v11.5c0 3.04 2.46 5.5 5.5 5.5s5.5-2.46 5.5-5.5V6h-1.5z"></path>
                    </svg>
                </button>
                <textarea id="prompt-input" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° ‡∏´‡∏£‡∏∑‡∏≠ ‡∏•‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏°‡∏≤‡πÑ‡∏ß‡πâ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ..." rows="1" aria-label="Your message"></textarea>
                <button type="submit" id="submit-button" class="icon-button primary" aria-label="Send message">
                    üì§
                </button>
            </form>
        </div>
    </div>
    
    <div id="settings-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <button id="close-settings-button" class="modal-close-button">&times;</button>
            <h2>üè∞ Ashval Chat Settings</h2>
            <form id="settings-form">
                <fieldset>
                    <legend>üß† Gemini AI</legend>
                    <p class="settings-description">
                        API Key ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Google Gemini AI
                    </p>
                    <label for="gemini-key">Gemini API Key</label>
                    <input type="password" id="gemini-key" name="geminiKey" autocomplete="new-password">
                </fieldset>
                
                <fieldset>
                    <legend>üìö Notion Integration</legend>
                    <p class="settings-description">
                        ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö Notion Database ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Ashval World
                    </p>
                    <label for="notion-token">Notion Token</label>
                    <input type="password" id="notion-token" name="notionToken" autocomplete="new-password">
                    
                    <label for="projects-db-id">Projects Database ID</label>
                    <input type="text" id="projects-db-id" name="projectsDbId">
                    
                    <label for="characters-db-id">Characters Database ID</label>
                    <input type="text" id="characters-db-id" name="charactersDbId">
                    
                    <label for="scenes-db-id">Scenes Database ID</label>
                    <input type="text" id="scenes-db-id" name="scenesDbId">
                    
                    <label for="locations-db-id">Locations Database ID</label>
                    <input type="text" id="locations-db-id" name="locationsDbId">
                </fieldset>
                
                <button type="submit" class="button primary">üíæ Save Settings</button>
            </form>
        </div>
    </div>
    
    <div id="toast-container" class="toast-container"></div>

    <script type="importmap">
{
  "imports": {
    "@google/genai": "https://esm.sh/@google/genai@^0.12.0",
    "pdfjs-dist/build/pdf.mjs": "https://esm.sh/pdfjs-dist@4.4.168/build/pdf.mjs",
    "mammoth": "https://esm.sh/mammoth@1.8.0",
    "xlsx": "https://esm.sh/xlsx@0.18.5",
    "jspdf": "https://esm.sh/jspdf@2.5.1",
    "html2canvas": "https://esm.sh/html2canvas@1.4.1",
    "pdfjs-dist/": "https://esm.sh/pdfjs-dist@^5.3.93/"
  }
}
</script>
    <script type="module" src="index.tsx"></script>
</body>
</html>
